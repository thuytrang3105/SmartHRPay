<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Qu·∫£n L√Ω Ch·ª©c V·ª• v√† Ph√≤ng Ban</title>
    <link rel="stylesheet" href="../static/depart_pos.css" />
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <h2>Trang Ch·ªß HR<br /></h2>
      <div class="menu-group">
        <h3>QU·∫¢N L√ù</h3>
        <ul>
          <li>
            <a href="employee_HR.html"><i>üë•</i> Nh√¢n vi√™n</a>
          </li>
          <li>
            <a href="depar_pos.html" class="active"
              ><i>üëî</i> Ph√≤ng ban v√† ch·ª©c v·ª•</a
            >
          </li>
          <li>
            <a href="reports_HR.html"><i>üìà</i> B√°o c√°o nh√¢n s·ª± </a>
          </li>
        </ul>
      </div>
      <div class="menu-group">
        <h3>H·ªÜ TH·ªêNG</h3>
        <ul>
          <li>
            <a href="logout.html"><i>üö™</i> ƒêƒÉng xu·∫•t</a>
          </li>
        </ul>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="header">
        <h1>Qu·∫£n L√Ω Ch·ª©c V·ª• v√† Ph√≤ng Ban</h1>
        <div class="user-info">NGUY·ªÑN VƒÇN A <br />HR</div>
      </div>

      <!-- Ch·ª©c V·ª• -->
      <div class="section">
        <div class="section-title">Ch·ª©c V·ª•</div>
        <div class="table-container">
          <div class="table-header">
            <div class="search-container">
              <input
                type="text"
                class="search-bar"
                id="searchPositionInput"
                placeholder="T√¨m ki·∫øm ch·ª©c v·ª•..."
              />
              <button class="search-btn" onclick="searchPositions()">
                T√¨m ki·∫øm
              </button>
            </div>
            <button class="add-btn" onclick="openAddPositionModal()">
              Th√™m Ch·ª©c V·ª•
            </button>
          </div>
          <table id="positionTable">
            <thead>
              <tr>
                <th>M√£ Ch·ª©c V·ª•</th>
                <th>T√™n Ch·ª©c V·ª•</th>
                <th>H√†nh ƒê·ªông</th>
              </tr>
            </thead>
            <tbody id="positionBody">
              <!-- D·ªØ li·ªáu m·∫´u -->
              <tr>
                <td>CV001</td>
                <td>Nh√¢n vi√™n</td>
                <td>
                  <button
                    class="action-btn view-btn"
                    onclick="viewPositionEmployees('CV001', 'Nh√¢n vi√™n')"
                  >
                    S·ª≠a
                  </button>
                  <button
                    class="action-btn delete-btn"
                    onclick="deletePosition('CV001')"
                  >
                    X√≥a
                  </button>
                </td>
              </tr>
              <tr>
                <td>CV002</td>
                <td>Qu·∫£n l√Ω</td>
                <td>
                  <button
                    class="action-btn view-btn"
                    onclick="viewPositionEmployees('CV002', 'Qu·∫£n l√Ω')"
                  >
                    S·ª≠a
                  </button>
                  <button
                    class="action-btn delete-btn"
                    onclick="deletePosition('CV002')"
                  >
                    X√≥a
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Ph√≤ng Ban -->
      <div class="section">
        <div class="section-title">Ph√≤ng Ban</div>
        <div class="table-container">
          <div class="table-header">
            <div class="search-container">
              <input
                type="text"
                class="search-bar"
                id="searchDepartmentInput"
                placeholder="T√¨m ki·∫øm ph√≤ng ban..."
              />
              <button class="search-btn" onclick="searchDepartments()">
                T√¨m ki·∫øm
              </button>
            </div>
            <button class="add-btn" onclick="openAddDepartmentModal()">
              Th√™m Ph√≤ng Ban
            </button>
          </div>
          <table id="departmentTable">
            <thead>
              <tr>
                <th>M√£ Ph√≤ng Ban</th>
                <th>T√™n Ph√≤ng Ban</th>
                <th>H√†nh ƒê·ªông</th>
              </tr>
            </thead>
            <tbody id="departmentBody">
              <!-- D·ªØ li·ªáu m·∫´u -->
              <tr>
                <td>PB001</td>
                <td>IT</td>
                <td>
                  <button
                    class="action-btn view-btn"
                    onclick="viewDepartmentEmployees('PB001', 'IT')"
                  >
                    S·ª≠a
                  </button>
                  <button
                    class="action-btn delete-btn"
                    onclick="deleteDepartment('PB001')"
                  >
                    X√≥a
                  </button>
                </td>
              </tr>
              <tr>
                <td>PB002</td>
                <td>HR</td>
                <td>
                  <button
                    class="action-btn view-btn"
                    onclick="viewDepartmentEmployees('PB002', 'HR')"
                  >
                    S·ª≠a
                  </button>
                  <button
                    class="action-btn delete-btn"
                    onclick="deleteDepartment('PB002')"
                  >
                    X√≥a
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Modal Th√™m Ch·ª©c V·ª• -->
    <div id="addPositionModal" class="modal">
      <div class="modal-content">
        <h2>Th√™m Ch·ª©c V·ª•</h2>
        <form id="addPositionForm">
          <label for="positionName">T√™n Ch·ª©c V·ª•:</label>
          <input type="text" id="positionName" name="positionName" required />

          <div class="modal-buttons">
            <button
              type="button"
              class="cancel-btn"
              onclick="closeAddPositionModal()"
            >
              H·ªßy
            </button>
            <button type="submit" class="save-btn">L∆∞u</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Th√™m Ph√≤ng Ban -->
    <div id="addDepartmentModal" class="modal">
      <div class="modal-content">
        <h2>Th√™m Ph√≤ng Ban</h2>
        <form id="addDepartmentForm">
          <label for="departmentName">T√™n Ph√≤ng Ban:</label>
          <input
            type="text"
            id="departmentName"
            name="departmentName"
            required
          />

          <div class="modal-buttons">
            <button
              type="button"
              class="cancel-btn"
              onclick="closeAddDepartmentModal()"
            >
              H·ªßy
            </button>
            <button type="submit" class="save-btn">L∆∞u</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Xem Danh S√°ch Nh√¢n Vi√™n Theo Ch·ª©c V·ª• -->
    <div id="positionEmployeesModal" class="modal">
      <div class="modal-content">
        <h2>
          Danh S√°ch Nh√¢n Vi√™n Theo Ch·ª©c V·ª•:
          <span id="positionNameDisplay"></span>
        </h2>
        <table id="positionEmployeesTable">
          <thead>
            <tr>
              <th>M√£ Nh√¢n Vi√™n</th>
              <th>T√™n</th>
              <th>Email</th>
            </tr>
          </thead>
          <tbody id="positionEmployeesBody"></tbody>
        </table>
        <div class="modal-buttons">
          <button class="close-btn" onclick="closePositionEmployeesModal()">
            ƒê√≥ng
          </button>
        </div>
      </div>
    </div>

    <!-- Modal Xem Danh S√°ch Nh√¢n Vi√™n Theo Ph√≤ng Ban -->
    <div id="departmentEmployeesModal" class="modal">
      <div class="modal-content">
        <h2>
          Danh S√°ch Nh√¢n Vi√™n Theo Ph√≤ng Ban:
          <span id="departmentNameDisplay"></span>
        </h2>
        <table id="departmentEmployeesTable">
          <thead>
            <tr>
              <th>M√£ Nh√¢n Vi√™n</th>
              <th>T√™n</th>
              <th>Email</th>
            </tr>
          </thead>
          <tbody id="departmentEmployeesBody"></tbody>
        </table>
        <div class="modal-buttons">
          <button class="close-btn" onclick="closeDepartmentEmployeesModal()">
            ƒê√≥ng
          </button>
        </div>
      </div>
    </div>

    <script>
      // D·ªØ li·ªáu nh√¢n vi√™n m·∫´u (m√¥ ph·ªèng)
      const employees = [
        {
          id: "NV001",
          name: "Nguy·ªÖn VƒÉn B",
          email: "nvb@example.com",
          position: "Nh√¢n vi√™n",
          department: "IT",
        },
        {
          id: "NV002",
          name: "Tr·∫ßn Th·ªã C",
          email: "ttc@example.com",
          position: "Qu·∫£n l√Ω",
          department: "HR",
        },
        {
          id: "NV003",
          name: "L√™ VƒÉn D",
          email: "lvd@example.com",
          position: "Nh√¢n vi√™n",
          department: "IT",
        },
        {
          id: "NV004",
          name: "Ph·∫°m Th·ªã E",
          email: "pte@example.com",
          position: "Qu·∫£n l√Ω",
          department: "HR",
        },
      ];

      // --- Ch·ª©c V·ª• ---
      // M·ªü modal th√™m ch·ª©c v·ª•
      function openAddPositionModal() {
        document.getElementById("addPositionModal").style.display = "block";
      }

      // ƒê√≥ng modal th√™m ch·ª©c v·ª•
      function closeAddPositionModal() {
        document.getElementById("addPositionModal").style.display = "none";
        document.getElementById("addPositionForm").reset();
      }

      // X·ª≠ l√Ω khi submit form th√™m ch·ª©c v·ª•
      document
        .getElementById("addPositionForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          // L·∫•y d·ªØ li·ªáu t·ª´ form
          const positionName = document.getElementById("positionName").value;

          // T·∫°o m√£ ch·ª©c v·ª• m·ªõi (m√¥ ph·ªèng)
          const positionId =
            "CV" + String(Math.floor(Math.random() * 1000)).padStart(3, "0");

          // Th√™m ch·ª©c v·ª• v√†o b·∫£ng
          const tableBody = document.getElementById("positionBody");
          const newRow = document.createElement("tr");
          newRow.innerHTML = `
          <td>${positionId}</td>
          <td>${positionName}</td>
          <td>
            <button class="action-btn view-btn" onclick="viewPositionEmployees('${positionId}', '${positionName}')">S·ª≠a</button>
            <button class="action-btn delete-btn" onclick="deletePosition('${positionId}')">X√≥a</button>
          </td>
        `;
          tableBody.appendChild(newRow);

          // ƒê√≥ng modal v√† reset form
          closeAddPositionModal();
        });

      // T√¨m ki·∫øm ch·ª©c v·ª•
      function searchPositions() {
        const input = document
          .querySelector("#searchPositionInput")
          .value.toLowerCase();
        const rows = document.querySelectorAll("#positionBody tr");
        rows.forEach((row) => {
          const text = row.textContent.toLowerCase();
          row.style.display = text.includes(input) ? "" : "none";
        });
      }

      // Xem danh s√°ch nh√¢n vi√™n theo ch·ª©c v·ª•
      function viewPositionEmployees(positionId, positionName) {
        document.getElementById("positionEmployeesModal").style.display =
          "block";
        document.getElementById("positionNameDisplay").textContent =
          positionName;

        // L·ªçc danh s√°ch nh√¢n vi√™n theo ch·ª©c v·ª•
        const filteredEmployees = employees.filter(
          (emp) => emp.position === positionName
        );
        const tableBody = document.getElementById("positionEmployeesBody");
        tableBody.innerHTML = "";

        if (filteredEmployees.length === 0) {
          tableBody.innerHTML = `<tr><td colspan="3">Kh√¥ng c√≥ nh√¢n vi√™n n√†o thu·ªôc ch·ª©c v·ª• n√†y.</td></tr>`;
        } else {
          filteredEmployees.forEach((emp) => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${emp.id}</td>
              <td>${emp.name}</td>
              <td>${emp.email}</td>
            `;
            tableBody.appendChild(row);
          });
        }
      }

      // ƒê√≥ng modal danh s√°ch nh√¢n vi√™n theo ch·ª©c v·ª•
      function closePositionEmployeesModal() {
        document.getElementById("positionEmployeesModal").style.display =
          "none";
      }

      // X√≥a ch·ª©c v·ª•
      function deletePosition(positionId) {
        if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ch·ª©c v·ª• ${positionId}?`)) {
          const row = document.querySelector(
            `#positionBody tr td:first-child:contains('${positionId}')`
          ).parentElement;
          row.remove();
        }
      }

      // --- Ph√≤ng Ban ---
      // M·ªü modal th√™m ph√≤ng ban
      function openAddDepartmentModal() {
        document.getElementById("addDepartmentModal").style.display = "block";
      }

      // ƒê√≥ng modal th√™m ph√≤ng ban
      function closeAddDepartmentModal() {
        document.getElementById("addDepartmentModal").style.display = "none";
        document.getElementById("addDepartmentForm").reset();
      }

      // X·ª≠ l√Ω khi submit form th√™m ph√≤ng ban
      document
        .getElementById("addDepartmentForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          // L·∫•y d·ªØ li·ªáu t·ª´ form
          const departmentName =
            document.getElementById("departmentName").value;

          // T·∫°o m√£ ph√≤ng ban m·ªõi (m√¥ ph·ªèng)
          const departmentId =
            "PB" + String(Math.floor(Math.random() * 1000)).padStart(3, "0");

          // Th√™m ph√≤ng ban v√†o b·∫£ng
          const tableBody = document.getElementById("departmentBody");
          const newRow = document.createElement("tr");
          newRow.innerHTML = `
          <td>${departmentId}</td>
          <td>${departmentName}</td>
          <td>
            <button class="action-btn view-btn" onclick="viewDepartmentEmployees('${departmentId}', '${departmentName}')">S·ª≠a</button>
            <button class="action-btn delete-btn" onclick="deleteDepartment('${departmentId}')">X√≥a</button>
          </td>
        `;
          tableBody.appendChild(newRow);

          // ƒê√≥ng modal v√† reset form
          closeAddDepartmentModal();
        });

      // T√¨m ki·∫øm ph√≤ng ban
      function searchDepartments() {
        const input = document
          .querySelector("#searchDepartmentInput")
          .value.toLowerCase();
        const rows = document.querySelectorAll("#departmentBody tr");
        rows.forEach((row) => {
          const text = row.textContent.toLowerCase();
          row.style.display = text.includes(input) ? "" : "none";
        });
      }

      // Xem danh s√°ch nh√¢n vi√™n theo ph√≤ng ban
      function viewDepartmentEmployees(departmentId, departmentName) {
        document.getElementById("departmentEmployeesModal").style.display =
          "block";
        document.getElementById("departmentNameDisplay").textContent =
          departmentName;

        // L·ªçc danh s√°ch nh√¢n vi√™n theo ph√≤ng ban
        const filteredEmployees = employees.filter(
          (emp) => emp.department === departmentName
        );
        const tableBody = document.getElementById("departmentEmployeesBody");
        tableBody.innerHTML = "";

        if (filteredEmployees.length === 0) {
          tableBody.innerHTML = `<tr><td colspan="3">Kh√¥ng c√≥ nh√¢n vi√™n n√†o thu·ªôc ph√≤ng ban n√†y.</td></tr>`;
        } else {
          filteredEmployees.forEach((emp) => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${emp.id}</td>
              <td>${emp.name}</td>
              <td>${emp.email}</td>
            `;
            tableBody.appendChild(row);
          });
        }
      }

      // ƒê√≥ng modal danh s√°ch nh√¢n vi√™n theo ph√≤ng ban
      function closeDepartmentEmployeesModal() {
        document.getElementById("departmentEmployeesModal").style.display =
          "none";
      }

      // X√≥a ph√≤ng ban
      function deleteDepartment(departmentId) {
        if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ph√≤ng ban ${departmentId}?`)) {
          const row = document.querySelector(
            `#departmentBody tr td:first-child:contains('${departmentId}')`
          ).parentElement;
          row.remove();
        }
      }

      // H√†m h·ªó tr·ª£ t√¨m ki·∫øm ph·∫ßn t·ª≠ b·∫±ng n·ªôi dung
      HTMLElement.prototype.contains = function (text) {
        return this.textContent.includes(text);
      };
    </script>
  </body>
</html>
