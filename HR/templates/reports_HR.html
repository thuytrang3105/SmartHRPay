<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>B√°o C√°o Nh√¢n S·ª±</title>
    <link rel="stylesheet" href="../static/reports_HR.css" />
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <h2>Trang Ch·ªß HR<br /></h2>
      <div class="menu-group">
        <h3>QU·∫¢N L√ù</h3>
        <ul>
          <li>
            <a href="employee_HR.html"><i>üë•</i> Nh√¢n vi√™n</a>
          </li>
          <li>
            <a href="depar_pos.html"><i>üëî</i> Ph√≤ng ban v√† ch·ª©c v·ª•</a>
          </li>
          <li>
            <a href="reports_HR.html" class="active"
              ><i>üìà</i> B√°o c√°o nh√¢n s·ª±
            </a>
          </li>
        </ul>
      </div>
      <div class="menu-group">
        <h3>H·ªÜ TH·ªêNG</h3>
        <ul>
          <li>
            <a href="logout.html"><i>üö™</i> ƒêƒÉng xu·∫•t</a>
          </li>
        </ul>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="header">
        <h1>B√°o c√°o chi ti·∫øt</h1>
        <div class="user-info">NGUY·ªÑN VƒÇN A <br />HR</div>
      </div>

      <div class="report-table">
        <div class="table-header">
          <div class="filter-container">
            <select id="timeFilter">
              <option value="today">H√¥m nay</option>
              <option value="thisMonth">Qu√Ω n√†y</option>
              <option value="thisYear">NƒÉm nay</option>
            </select>
          </div>
        </div>
        <table id="reportTable">
          <thead>
            <tr>
              <th>Ph√≤ng ban</th>
              <th>T·ªïng nh√¢n vi√™n</th>
              <th>Nh√¢n vi√™n m·ªõi</th>
              <th>Ngh·ªâ vi·ªác</th>
              <th>T·ª∑ l·ªá bi·∫øn ƒë·ªông</th>
            </tr>
          </thead>
          <tbody id="reportBody">
            <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
          </tbody>
        </table>
      </div>
    </div>

    <script>
      // T·∫£i d·ªØ li·ªáu t·ª´ file JSON
      async function loadEmployees() {
        try {
          const response = await fetch("../data/employee.json");
          const data = await response.json();
          return data;
        } catch (error) {
          console.error("L·ªói khi t·∫£i d·ªØ li·ªáu t·ª´ JSON:", error);
          return [];
        }
      }

      // T·∫£i b√°o c√°o khi trang ƒë∆∞·ª£c t·∫£i
      window.onload = async function () {
        const employees = await loadEmployees();
        generateReport(employees);
      };

      // H√†m t·∫°o b√°o c√°o
      function generateReport(employees) {
        const timeFilter = document.getElementById("timeFilter").value;
        const departments = ["IT", "HR", "Marketing", "Operations", "Finance"];
        const reportBody = document.getElementById("reportBody");
        reportBody.innerHTML = "";

        let totalEmployees = 0;
        let totalNewEmployees = 0;
        let totalResigned = 0;

        departments.forEach((dept) => {
          // L·ªçc nh√¢n vi√™n theo ph√≤ng ban
          const deptEmployees = employees.filter(
            (emp) => emp.department === dept
          );

          // T·ªïng nh√¢n vi√™n
          const total = deptEmployees.length;

          // Nh√¢n vi√™n m·ªõi (gi·∫£ s·ª≠ nh√¢n vi√™n m·ªõi l√† nh·ªØng ng∆∞·ªùi v√†o l√†m trong nƒÉm nay)
          const currentYear = new Date().getFullYear();
          const newEmployees = deptEmployees.filter((emp) => {
            const hireYear = new Date(emp.hireDate).getFullYear();
            return hireYear === currentYear;
          }).length;

          // Nh√¢n vi√™n ngh·ªâ vi·ªác
          const resigned = deptEmployees.filter(
            (emp) => emp.status === "Ngh·ªâ vi·ªác"
          ).length;

          // T·ª∑ l·ªá bi·∫øn ƒë·ªông (gi·∫£ s·ª≠ t√≠nh b·∫±ng (nh√¢n vi√™n m·ªõi + ngh·ªâ vi·ªác) / t·ªïng nh√¢n vi√™n)
          const turnoverRate =
            total > 0
              ? (((newEmployees + resigned) / total) * 100).toFixed(2) + "%"
              : "0.00%";

          // Th√™m h√†ng v√†o b·∫£ng
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${dept}</td>
            <td>${total}</td>
            <td>${newEmployees}</td>
            <td>${resigned}</td>
            <td>${turnoverRate}</td>
          `;
          reportBody.appendChild(row);

          // C·ªông d·ªìn t·ªïng
          totalEmployees += total;
          totalNewEmployees += newEmployees;
          totalResigned += resigned;
        });

        // Th√™m h√†ng "T·ªïng c·ªông"
        const totalTurnoverRate =
          totalEmployees > 0
            ? (
                ((totalNewEmployees + totalResigned) / totalEmployees) *
                100
              ).toFixed(2) + "%"
            : "0.00%";
        const totalRow = document.createElement("tr");
        totalRow.classList.add("total-row");
        totalRow.innerHTML = `
          <td>T·ªïng c·ªông</td>
          <td>${totalEmployees}</td>
          <td>${totalNewEmployees}</td>
          <td>${totalResigned}</td>
          <td>${totalTurnoverRate}</td>
        `;
        reportBody.appendChild(totalRow);
      }

      // L·ªçc theo th·ªùi gian
      document
        .getElementById("timeFilter")
        .addEventListener("change", async () => {
          const employees = await loadEmployees();
          generateReport(employees);
        });
    </script>
  </body>
</html>
