<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Qu·∫£n L√Ω Nh√¢n Vi√™n</title>
    <link rel="stylesheet" href="../static/employee_HR.css" />
    <style>
      .modal-content {
        width: 600px;
        max-width: 90%;
      }
      .modal-content input,
      .modal-content select {
        width: 100%;
        padding: 8px;
        margin-bottom: 15px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      .modal-buttons {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <h2>Trang Ch·ªß HR<br /></h2>
      <div class="menu-group">
        <h3>QU·∫¢N L√ù</h3>
        <ul>
          <li>
            <a href="employee_HR.html" class="active"><i>üë•</i> Nh√¢n vi√™n</a>
          </li>
          <li>
            <a href="depar_pos.html"><i>üëî</i> Ph√≤ng ban v√† ch·ª©c v·ª•</a>
          </li>
          <li>
            <a href="reports_HR.html"><i>üìà</i> B√°o c√°o nh√¢n s·ª± </a>
          </li>
        </ul>
      </div>
      <div class="menu-group">
        <h3>H·ªÜ TH·ªêNG</h3>
        <ul>
          <li>
            <a href="logout.html"><i>üö™</i> ƒêƒÉng xu·∫•t</a>
          </li>
        </ul>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="header">
        <h1>Qu·∫£n L√Ω Nh√¢n Vi√™n</h1>
        <div class="user-info">NGUY·ªÑN VƒÇN A <br />HR</div>
      </div>

      <div class="employee-table">
        <div class="table-header">
          <div class="search-container">
            <input
              type="text"
              class="search-bar"
              id="searchInput"
              placeholder="T√¨m ki·∫øm nh√¢n vi√™n..."
            />
            <button class="search-btn" onclick="searchEmployees()">
              T√¨m ki·∫øm
            </button>
          </div>
          <button class="add-btn" onclick="openAddModal()">
            Th√™m Nh√¢n Vi√™n
          </button>
        </div>
        <table id="employeeTable">
          <thead>
            <tr>
              <th>M√£ Nh√¢n Vi√™n</th>
              <th>H·ªç T√™n</th>
              <th>Ch·ª©c V·ª•</th>
              <th>Ph√≤ng Ban</th>
              <th>Email</th>
              <th>Ng√†y V√†o L√†m</th>
              <th>L∆∞∆°ng C∆° B·∫£n</th>
              <th>Tr·∫°ng Th√°i</th>
              <th>H√†nh ƒê·ªông</th>
            </tr>
          </thead>
          <tbody id="employeeBody">
            <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Modal Th√™m Nh√¢n Vi√™n -->
    <div id="addEmployeeModal" class="modal">
      <div class="modal-content">
        <h2>Th√™m Nh√¢n Vi√™n</h2>
        <form id="addEmployeeForm">
          <label for="firstName">T√™n:</label>
          <input type="text" id="firstName" name="firstName" required />

          <label for="lastName">H·ªç:</label>
          <input type="text" id="lastName" name="lastName" required />
          <label for="email">Email:</label>
          <input type="email" id="email" name="email" required />

          <label for="phone">S·ªë ƒëi·ªán tho·∫°i:</label>
          <input type="tel" id="phone" name="phone" required />

          <label for="position">Ch·ª©c v·ª•:</label>
          <select id="position" name="position" required>
            <option value="Nh√¢n vi√™n">Nh√¢n vi√™n</option>
            <option value="Qu·∫£n l√Ω">Qu·∫£n l√Ω</option>
          </select>

          <label for="department">Ph√≤ng ban:</label>
          <select id="department" name="department" required>
            <option value="IT">IT</option>
            <option value="HR">HR</option>
          </select>

          <label for="hireDate">Ng√†y v√†o l√†m:</label>
          <input type="date" id="hireDate" name="hireDate" required />

          <label for="workShift">Ca l√†m vi·ªác:</label>
          <select id="workShift" name="workShift" required>
            <option value="S√°ng">S√°ng</option>
            <option value="Chi·ªÅu">Chi·ªÅu</option>
            <option value="T·ªëi">T·ªëi</option>
          </select>

          <label for="contractType">Lo·∫°i h·ª£p ƒë·ªìng:</label>
          <select id="contractType" name="contractType" required>
            <option value="To√†n th·ªùi gian">To√†n th·ªùi gian</option>
            <option value="B√°n th·ªùi gian">B√°n th·ªùi gian</option>
          </select>

          <label for="salary">L∆∞∆°ng c∆° b·∫£n (VNƒê):</label>
          <input type="number" id="salary" name="salary" required />

          <label for="bonus">Ti·ªÅn th∆∞·ªüng (VNƒê):</label>
          <input type="number" id="bonus" name="bonus" required />

          <label for="deductions">Kho·∫£n kh·∫•u tr·ª´ (VNƒê):</label>
          <input type="number" id="deductions" name="deductions" required />

          <div class="modal-buttons">
            <button type="button" class="cancel-btn" onclick="closeAddModal()">
              H·ªßy
            </button>
            <button type="submit" class="save-btn">L∆∞u</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Ch·ªânh S·ª≠a Nh√¢n Vi√™n -->
    <div id="editEmployeeModal" class="modal">
      <div class="modal-content">
        <h2>Ch·ªânh S·ª≠a Nh√¢n Vi√™n</h2>
        <form id="editEmployeeForm">
          <input type="hidden" id="editEmployeeId" name="employeeId" />
          <label for="editFirstName">T√™n:</label>
          <input type="text" id="editFirstName" name="firstName" required />

          <label for="editLastName">H·ªç:</label>
          <input type="text" id="editLastName" name="lastName" required />

          <label for="editEmail">Email:</label>
          <input type="email" id="editEmail" name="email" required />

          <label for="editPhone">S·ªë ƒëi·ªán tho·∫°i:</label>
          <input type="tel" id="editPhone" name="phone" required />

          <label for="editPosition">Ch·ª©c v·ª•:</label>
          <select id="editPosition" name="position" required>
            <option value="Nh√¢n vi√™n">Nh√¢n vi√™n</option>
            <option value="Qu·∫£n l√Ω">Qu·∫£n l√Ω</option>
          </select>

          <label for="editDepartment">Ph√≤ng ban:</label>
          <select id="editDepartment" name="department" required>
            <option value="IT">IT</option>
            <option value="HR">HR</option>
          </select>

          <label for="editHireDate">Ng√†y v√†o l√†m:</label>
          <input type="date" id="editHireDate" name="hireDate" required />

          <label for="editWorkShift">Ca l√†m vi·ªác:</label>
          <select id="editWorkShift" name="workShift" required>
            <option value="S√°ng">S√°ng</option>
            <option value="Chi·ªÅu">Chi·ªÅu</option>
            <option value="T·ªëi">T·ªëi</option>
          </select>

          <label for="editContractType">Lo·∫°i h·ª£p ƒë·ªìng:</label>
          <select id="editContractType" name="contractType" required>
            <option value="To√†n th·ªùi gian">To√†n th·ªùi gian</option>
            <option value="B√°n th·ªùi gian">B√°n th·ªùi gian</option>
          </select>

          <label for="editSalary">L∆∞∆°ng c∆° b·∫£n (VNƒê):</label>
          <input type="number" id="editSalary" name="salary" required />

          <label for="editBonus">Ti·ªÅn th∆∞·ªüng (VNƒê):</label>
          <input type="number" id="editBonus" name="bonus" required />

          <label for="editDeductions">Kho·∫£n kh·∫•u tr·ª´ (VNƒê):</label>
          <input type="number" id="editDeductions" name="deductions" required />

          <div class="modal-buttons">
            <button type="button" class="cancel-btn" onclick="closeEditModal()">
              H·ªßy
            </button>
            <button type="submit" class="save-btn">L∆∞u</button>
          </div>
        </form>
      </div>
    </div>

    <script>
      // D·ªØ li·ªáu nh√¢n vi√™n (m√¥ ph·ªèng)
      let employees = JSON.parse(localStorage.getItem("employees")) || [
        {
          id: "NV001",
          name: "Nguy·ªÖn VƒÉn B",
          position: "Nh√¢n vi√™n",
          department: "IT",
          email: "nvb@example.com",
          hireDate: "2023-01-15",
          salary: 10000000,
          status: "ƒêang l√†m vi·ªác",
          gender: "Nam",
          dob: "1990-05-20",
          address: "123 ƒê∆∞·ªùng A, H√† N·ªôi",
          workShift: "S√°ng",
          contractType: "To√†n th·ªùi gian",
          bonus: 500000,
          deductions: 200000,
        },
        {
          id: "NV002",
          name: "Tr·∫ßn Th·ªã C",
          position: "Qu·∫£n l√Ω",
          department: "HR",
          email: "ttc@example.com",
          hireDate: "2022-06-10",
          salary: 15000000,
          status: "ƒêang l√†m vi·ªác",
          gender: "N·ªØ",
          dob: "1985-08-15",
          address: "456 ƒê∆∞·ªùng B, TP.HCM",
          workShift: "Chi·ªÅu",
          contractType: "To√†n th·ªùi gian",
          bonus: 1000000,
          deductions: 300000,
        },
      ];

      // T·∫£i d·ªØ li·ªáu nh√¢n vi√™n v√†o b·∫£ng khi trang ƒë∆∞·ª£c t·∫£i
      window.onload = function () {
        loadEmployees();
      };

      function loadEmployees() {
        const tableBody = document.getElementById("employeeBody");
        tableBody.innerHTML = "";
        employees.forEach((employee) => {
          const row = document.createElement("tr");
          row.innerHTML = `
              <td>${employee.id}</td>
              <td>${employee.name}</td>
              <td>${employee.position}</td>
              <td>${employee.department}</td>
              <td>${employee.email}</td>
              <td>${employee.hireDate}</td>
              <td>${employee.salary.toLocaleString()}</td>
              <td>${employee.status}</td>
              <td>
                <button class="action-btn view-btn" onclick="viewEmployee('${
                  employee.id
                }')">Xem</button>
                <button class="action-btn delete-btn" onclick="deleteEmployee('${
                  employee.id
                }')">X√≥a</button>
              </td>
            `;
          tableBody.appendChild(row);
        });
      }

      // M·ªü modal th√™m nh√¢n vi√™n
      function openAddModal() {
        document.getElementById("addEmployeeModal").style.display = "flex";
      }

      // ƒê√≥ng modal th√™m nh√¢n vi√™n
      function closeAddModal() {
        document.getElementById("addEmployeeModal").style.display = "none";
        document.getElementById("addEmployeeForm").reset();
      }

      // X·ª≠ l√Ω khi submit form th√™m nh√¢n vi√™n
      document
        .getElementById("addEmployeeForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const employee = {
            id:
              "NV" + String(Math.floor(Math.random() * 1000)).padStart(3, "0"),
            name:
              document.getElementById("lastName").value +
              " " +
              document.getElementById("firstName").value,
            gender: document.getElementById("gender").value,
            dob: document.getElementById("dob").value,
            address: document.getElementById("address").value,
            email: document.getElementById("email").value,
            phone: document.getElementById("phone").value,
            position: document.getElementById("position").value,
            department: document.getElementById("department").value,
            hireDate: document.getElementById("hireDate").value,
            workShift: document.getElementById("workShift").value,
            contractType: document.getElementById("contractType").value,
            salary: parseInt(document.getElementById("salary").value),
            bonus: parseInt(document.getElementById("bonus").value),
            deductions: parseInt(document.getElementById("deductions").value),
            status: "ƒêang l√†m vi·ªác",
          };

          employees.push(employee);
          localStorage.setItem("employees", JSON.stringify(employees));
          loadEmployees();
          closeAddModal();
        });

      // M·ªü modal ch·ªânh s·ª≠a nh√¢n vi√™n
      function openEditModal(employeeId) {
        const employee = employees.find((emp) => emp.id === employeeId);
        if (employee) {
          document.getElementById("editEmployeeId").value = employee.id;
          document.getElementById("editFirstName").value = employee.name
            .split(" ")
            .slice(-1)[0];
          document.getElementById("editLastName").value = employee.name
            .split(" ")
            .slice(0, -1)
            .join(" ");
          document.getElementById("editGender").value = employee.gender;
          document.getElementById("editDob").value = employee.dob;
          document.getElementById("editAddress").value = employee.address;
          document.getElementById("editEmail").value = employee.email;
          document.getElementById("editPhone").value = employee.phone;
          document.getElementById("editPosition").value = employee.position;
          document.getElementById("editDepartment").value = employee.department;
          document.getElementById("editHireDate").value = employee.hireDate;
          document.getElementById("editWorkShift").value = employee.workShift;
          document.getElementById("editContractType").value =
            employee.contractType;
          document.getElementById("editSalary").value = employee.salary;
          document.getElementById("editBonus").value = employee.bonus;
          document.getElementById("editDeductions").value = employee.deductions;

          document.getElementById("editEmployeeModal").style.display = "flex";
        }
      }

      // ƒê√≥ng modal ch·ªânh s·ª≠a nh√¢n vi√™n
      function closeEditModal() {
        document.getElementById("editEmployeeModal").style.display = "none";
        document.getElementById("editEmployeeForm").reset();
      }

      // X·ª≠ l√Ω khi submit form ch·ªânh s·ª≠a nh√¢n vi√™n
      document
        .getElementById("editEmployeeForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const employeeId = document.getElementById("editEmployeeId").value;
          const updatedEmployee = {
            id: employeeId,
            name:
              document.getElementById("editLastName").value +
              " " +
              document.getElementById("editFirstName").value,
            gender: document.getElementById("editGender").value,
            dob: document.getElementById("editDob").value,
            address: document.getElementById("editAddress").value,
            email: document.getElementById("editEmail").value,
            phone: document.getElementById("editPhone").value,
            position: document.getElementById("editPosition").value,
            department: document.getElementById("editDepartment").value,
            hireDate: document.getElementById("editHireDate").value,
            workShift: document.getElementById("editWorkShift").value,
            contractType: document.getElementById("editContractType").value,
            salary: parseInt(document.getElementById("editSalary").value),
            bonus: parseInt(document.getElementById("editBonus").value),
            deductions: parseInt(
              document.getElementById("editDeductions").value
            ),
            status: employees.find((emp) => emp.id === employeeId).status,
          };

          const index = employees.findIndex((emp) => emp.id === employeeId);
          if (index !== -1) {
            employees[index] = updatedEmployee;
            localStorage.setItem("employees", JSON.stringify(employees));
            loadEmployees();
            closeEditModal();
          }
        });

      // T√¨m ki·∫øm nh√¢n vi√™n
      function searchEmployees() {
        const input = document
          .getElementById("searchInput")
          .value.toLowerCase();
        const rows = document.querySelectorAll("#employeeBody tr");
        rows.forEach((row) => {
          const cells = row.getElementsByTagName("td");
          const text = Array.from(cells)
            .map((cell) => cell.textContent.toLowerCase())
            .join(" ");
          row.style.display = text.includes(input) ? "" : "none";
        });
      }

      // Xem th√¥ng tin chi ti·∫øt nh√¢n vi√™n
      function viewEmployee(employeeId) {
        window.location.href = `employee_detail.html?id=${employeeId}`;
      }

      // X√≥a nh√¢n vi√™n
      function deleteEmployee(employeeId) {
        if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a nh√¢n vi√™n ${employeeId}?`)) {
          employees = employees.filter((emp) => emp.id !== employeeId);
          localStorage.setItem("employees", JSON.stringify(employees));
          loadEmployees();
        }
      }
    </script>
  </body>
</html>
