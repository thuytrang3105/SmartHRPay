<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cáº­p Nháº­t Quyá»n NgÆ°á»i DÃ¹ng</title>
    <link rel="stylesheet" href="../static/update_user_role.css" />
  </head>
  <body>
    <div class="sidebar">
      <h2>Trang Chá»§ Admin<br /></h2>

        <div class="menu-group">
          <h3>Tá»”NG QUAN</h3>
          <ul>
              <li>
                  <a href="{{ url_for('dashboard_AD') }}" ><i>ğŸ“Š</i> Dashboard</a>
              </li>
          </ul>
        </div>

      <div class="menu-group">
          <h3>QUáº¢N LÃ</h3>
          <ul>
            <li><a href="{{ url_for('home_HR') }}"><i>ğŸ‘¥</i> NhÃ¢n viÃªn</a></li>
            <li><a href="{{ url_for('home_AC') }}"><i>ğŸ’°</i> LÆ°Æ¡ng</a></li>
            <li><a href="{{ url_for('shareholder') }}" ><i>ğŸ”‘</i> Cá»• ÄÃ´ng</a></li>
            <li><a href="{{ url_for('user_roles') }}"  class="active"><i>ğŸ¢</i> PhÃ¢n quyá»n ngÆ°á»i dÃ¹ng</a></li>
            <li><a href="{{ url_for('notifications_AD') }}" ><i>ğŸ“¢</i> Quáº£n lÃ½ thÃ´ng bÃ¡o</a></li>
          </ul>
      </div>

      <div class="menu-group">
          <h3>BÃO CÃO</h3>
          <ul>
              <li><a href="{{ url_for('reports_AD') }}"><i>ğŸ“ˆ</i> BÃ¡o cÃ¡o nhÃ¢n sá»±</a></li>
              <li><a href="{{ url_for('activity_log_AD') }}"><i>ğŸ“œ</i> Lá»‹ch sá»­ hoáº¡t Ä‘á»™ng</a></li>
          </ul>
      </div>

      <div class="menu-group">
          <h3>Há»† THá»NG</h3>
          <ul>
            <li><a href="{{ url_for('logout') }}" ><i>ğŸšª</i> ÄÄƒng xuáº¥t</a></li>
          </ul>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="header">
        <h1>Cáº­p Nháº­t Quyá»n NgÆ°á»i DÃ¹ng</h1>
        <div class="user-info">NGUYá»„N VÄ‚N B<br />ADMIN</div>
      </div>

      <!-- Form -->
      <div class="form-container">
        <div class="form-group">
          <label for="userId">ID NgÆ°á»i DÃ¹ng</label>
          <input type="text" id="userId" disabled />
        </div>
        <div class="form-group">
          <label for="username">TÃªn NgÆ°á»i DÃ¹ng</label>
          <input type="text" id="username" disabled />
        </div>
        <div class="form-group">
          <label for="role">Quyá»n</label>
          <select id="role">
            <option value="admin">Admin</option>
            <option value="user">HR</option>
            <option value="admin">Accountant</option>
            <option value="user">User</option>
          </select>
        </div>
        <button class="submit-btn" onclick="updateUserRole()">Cáº­p Nháº­t</button>
        <div id="message" class="message"></div>
      </div>
    </div>

    <script>
      // Láº¥y user_id tá»« URL
      const urlParams = new URLSearchParams(window.location.search);
      const userId = urlParams.get("user_id");

      // HÃ m láº¥y thÃ´ng tin ngÆ°á»i dÃ¹ng tá»« API
      async function fetchUserInfo() {
        try {
          const response = await fetch("http://localhost:5000/user-roles");
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          const data = await response.json();

          // TÃ¬m ngÆ°á»i dÃ¹ng theo user_id
          const user = data.find((u) => u.user_id == userId);
          if (user) {
            document.getElementById("userId").value = user.user_id;
            document.getElementById("username").value = user.username;
            document.getElementById("role").value = user.role;
          } else {
            showMessage("KhÃ´ng tÃ¬m tháº¥y ngÆ°á»i dÃ¹ng.", "error");
          }
        } catch (error) {
          console.error("Lá»—i khi láº¥y thÃ´ng tin ngÆ°á»i dÃ¹ng:", error);
          showMessage(
            "KhÃ´ng thá»ƒ táº£i thÃ´ng tin ngÆ°á»i dÃ¹ng. Vui lÃ²ng thá»­ láº¡i sau.",
            "error"
          );
        }
      }

      // HÃ m cáº­p nháº­t quyá»n ngÆ°á»i dÃ¹ng
      async function updateUserRole() {
        const role = document.getElementById("role").value;

        try {
          const response = await fetch(
            `http://localhost:5000/update-user-role/${userId}`,
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ role }),
            }
          );

          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }

          const data = await response.json();
          showMessage(data.message, "success");

          // Chuyá»ƒn hÆ°á»›ng vá» trang phÃ¢n quyá»n sau 2 giÃ¢y
          setTimeout(() => {
            window.location.href = "user_roles_AD.html";
          }, 2000);
        } catch (error) {
          console.error("Lá»—i khi cáº­p nháº­t quyá»n ngÆ°á»i dÃ¹ng:", error);
          showMessage(
            "KhÃ´ng thá»ƒ cáº­p nháº­t quyá»n. Vui lÃ²ng thá»­ láº¡i sau.",
            "error"
          );
        }
      }

      // HÃ m hiá»ƒn thá»‹ thÃ´ng bÃ¡o
      function showMessage(text, type) {
        const messageDiv = document.getElementById("message");
        messageDiv.textContent = text;
        messageDiv.className = `message ${type}`;
        messageDiv.style.display = "block";

        // áº¨n thÃ´ng bÃ¡o sau 5 giÃ¢y
        setTimeout(() => {
          messageDiv.style.display = "none";
        }, 5000);
      }

      // Gá»i hÃ m láº¥y thÃ´ng tin ngÆ°á»i dÃ¹ng khi trang Ä‘Æ°á»£c táº£i
      fetchUserInfo();
    </script>
  </body>
</html>
