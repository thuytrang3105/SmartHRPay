<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>B√°o C√°o Nh√¢n S·ª±</title>
    <link rel="stylesheet" href="../static/reports_AD.css" />
    <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <h2>Trang Ch·ªß Admin<br /></h2>

      <div class="menu-group">
        <h3>T·ªîNG QUAN</h3>
        <ul>
          <li>
            <a href="dashboard_AD.html"><i>üìä</i> Dashboard</a>
          </li>
        </ul>
      </div>

      <div class="menu-group">
        <h3>QU·∫¢N L√ù</h3>
        <ul>
          <li>
            <a href="home_HR.html"><i>üë•</i> Nh√¢n vi√™n</a>
          </li>
          <li>
            <a href="home_AC.html"><i>üí∞</i> L∆∞∆°ng</a>
          </li>
          <li>
            <a href="user_roles_AD.html"><i>üè¢</i> Ph√¢n quy·ªÅn ng∆∞·ªùi d√πng</a>
          </li>
          <li>
            <a href="update_user_role.html"
              ><i>üîë</i> C·∫≠p nh·∫≠t quy·ªÅn ng∆∞·ªùi d√πng</a
            >
          </li>
          <li>
            <a href="notifications_AD.html"><i>üì¢</i> Qu·∫£n l√Ω th√¥ng b√°o</a>
          </li>
        </ul>
      </div>

      <div class="menu-group">
        <h3>B√ÅO C√ÅO</h3>
        <ul>
          <li>
            <a href="reports_AD.html" class="active"
              ><i>üìà</i> B√°o c√°o nh√¢n s·ª±</a
            >
          </li>
          <li>
            <a href="activity_log_AD.html"><i>üìú</i> L·ªãch s·ª≠ ho·∫°t ƒë·ªông</a>
          </li>
        </ul>
      </div>

      <div class="menu-group">
        <h3>H·ªÜ TH·ªêNG</h3>
        <ul>
          <li>
            <a href="logout.html"><i>üö™</i> ƒêƒÉng xu·∫•t</a>
          </li>
        </ul>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="header">
        <h1>B√°o C√°o Nh√¢n S·ª±</h1>
        <div class="user-info">NGUY·ªÑN VƒÇN B<br />ADMIN</div>
      </div>

      <!-- Table -->
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Vai tr√≤</th>
              <th>T·ªïng nh√¢n vi√™n</th>
              <th>Nh√¢n vi√™n m·ªõi</th>
              <th>Nh√¢n vi√™n ngh·ªâ vi·ªác</th>
              <th>Ph√≤ng ban</th>
            </tr>
          </thead>
          <tbody id="reportTable">
            <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
          </tbody>
        </table>
      </div>

      <!-- Charts -->
      <div class="charts">
        <div class="chart-box">
          <h3>So s√°nh T·ªïng nh√¢n vi√™n</h3>
          <canvas id="totalChart"></canvas>
        </div>
        <div class="chart-box">
          <h3>TƒÉng tr∆∞·ªüng Nh√¢n vi√™n m·ªõi</h3>
          <canvas id="newChart"></canvas>
        </div>
      </div>
    </div>

    <script>
      // H√†m l·∫•y d·ªØ li·ªáu b√°o c√°o t·ª´ API
      async function fetchReports() {
        try {
          const response = await fetch("http://localhost:5000/reports");
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          const data = await response.json();

          // C·∫≠p nh·∫≠t b·∫£ng
          const tableBody = document.getElementById("reportTable");
          tableBody.innerHTML = ""; // X√≥a d·ªØ li·ªáu c≈©

          data.forEach((report) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                        <td>${report.role}</td>
                        <td>${report.total}</td>
                        <td>${report.newEmployees}</td>
                        <td>${report.resignedEmployees}</td>
                        <td>${report.departments}</td>
                    `;
            tableBody.appendChild(row);
          });

          // Ki·ªÉm tra Chart.js ƒë√£ t·∫£i ch∆∞a
          if (typeof Chart === "undefined") {
            console.error(
              "Chart.js ch∆∞a ƒë∆∞·ª£c t·∫£i. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi ho·∫∑c CDN."
            );
            return;
          }

          // V·∫Ω bi·ªÉu ƒë·ªì so s√°nh t·ªïng nh√¢n vi√™n
          const totalChart = new Chart(document.getElementById("totalChart"), {
            type: "bar",
            data: {
              labels: data.map((report) => report.role),
              datasets: [
                {
                  label: "T·ªïng nh√¢n vi√™n",
                  data: data.map((report) => report.total),
                  backgroundColor: ["#3498db", "#2ecc71", "#f1c40f"],
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              scales: {
                y: {
                  beginAtZero: true,
                },
              },
              plugins: {
                legend: {
                  display: false,
                },
              },
            },
          });

          // V·∫Ω bi·ªÉu ƒë·ªì tƒÉng tr∆∞·ªüng nh√¢n vi√™n m·ªõi
          const newChart = new Chart(document.getElementById("newChart"), {
            type: "line",
            data: {
              labels: data.map((report) => report.role),
              datasets: [
                {
                  label: "Nh√¢n vi√™n m·ªõi",
                  data: data.map((report) => report.newEmployees),
                  borderColor: "#3498db",
                  fill: false,
                  tension: 0.1,
                },
              ],
            },
            options: {
              responsive: true,
              scales: {
                y: {
                  beginAtZero: true,
                },
              },
            },
          });
        } catch (error) {
          console.error("L·ªói khi l·∫•y d·ªØ li·ªáu b√°o c√°o:", error);
          const tableBody = document.getElementById("reportTable");
          tableBody.innerHTML =
            '<tr><td colspan="5" class="error-message">Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu b√°o c√°o. Vui l√≤ng th·ª≠ l·∫°i sau.</td></tr>';
        }
      }

      // G·ªçi h√†m l·∫•y d·ªØ li·ªáu khi trang ƒë∆∞·ª£c t·∫£i
      fetchReports();
    </script>
  </body>
</html>
