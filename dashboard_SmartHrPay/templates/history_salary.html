{% extends 'base.html' %}

{% block title %}L·ªãch s·ª≠ l∆∞∆°ng nh√¢n vi√™n{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{{ url_for('static', filename='history_salary.css') }}">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"></script>
  <style>
    .panel {
      margin: 20px;
      padding: 20px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .header h2 {
      color: #333;
      margin-bottom: 20px;
    }
    .filter-container {
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }
    .filter-container label {
      font-weight: bold;
    }
    .filter-container select, .filter-container button {
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    .btn {
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
    }
    .btn:hover {
      background-color: #0056b3;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: #f4f4f4;
      font-weight: bold;
    }
    tr:hover {
      background-color: #f9f9f9;
    }
    .details-link {
      color: #007bff;
      text-decoration: none;
    }
    .details-link:hover {
      text-decoration: underline;
    }
    @media (max-width: 600px) {
      .filter-container {
        flex-direction: column;
        align-items: flex-start;
      }
      table {
        font-size: 14px;
      }
    }
  </style>
{% endblock %}

{% block content %}
  <div class="panel" id="employee-history">
    <div class="header">
      <h2>L·ªãch s·ª≠ l∆∞∆°ng</h2>
    </div>
    <div class="panel-body">
      <div class="filter-container">
        <label for="year-filter">Ch·ªçn nƒÉm:</label>
        <select id="year-filter">
          {% for year in available_years %}
            <option value="{{ year }}" {% if year == selected_year %}selected{% endif %}>NƒÉm {{ year }}</option>
          {% endfor %}
        </select>

        <label for="month-filter">Ch·ªçn th√°ng:</label>
        <select id="month-filter">
          {% for month in available_months %}
            <option value="{{ month }}" {% if month == selected_month %}selected{% endif %}>Th√°ng {{ month }}</option>
          {% endfor %}
        </select>

        {% if selected_month or selected_year %}
          <button class="btn" id="filter-button">B·ªè L·ªçc</button>
        {% endif %}
      </div>

      <p>
        <h3>üìÖ ƒêang xem b·∫£ng l∆∞∆°ng c·ªßa 
          <strong>
            th√°ng {{ selected_month }} nƒÉm {{ selected_year }}
          </strong>
        </h3>
      </p>

      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>T√™n nh√¢n vi√™n</th>
            <th>Ph√≤ng ban</th>
            <th>Ch·ª©c v·ª•</th>
            <th>L∆∞∆°ng c∆° b·∫£n</th>
            <th>Th∆∞·ªüng</th>
            <th>Kh·∫•u tr·ª´</th>
            <th>T·ªïng l∆∞∆°ng</th>
            <th>Chi ti·∫øt</th>
          </tr>
        </thead>
        <tbody>
          {% for employee in payroll_data %}
            <tr>
              <td>{{ employee.id }}</td>
              <td>{{ employee.name }}</td>
              <td>{{ employee.department }}</td>
              <td>{{ employee.position }}</td>
              <td>{{ "{:,.0f}".format(employee.base_salary) }} ƒë</td>
              <td>{{ "{:,.0f}".format(employee.bonus) }} ƒë</td>
              <td>{{ "{:,.0f}".format(employee.deduction) }} ƒë</td>
              <td>{{ "{:,.0f}".format(employee.total_salary) }} ƒë</td>
              <td>
                <a href="{{ url_for('payroll_detail', payroll_id=employee.payroll_id) }}" class="details-link">
                  Xem chi ti·∫øt
                </a>
              </td>
            </tr>
          {% endfor %}
          {% if not payroll_data %}
            <tr>
              <td colspan="9">Kh√¥ng c√≥ d·ªØ li·ªáu l∆∞∆°ng cho th√°ng v√† nƒÉm ƒë∆∞·ª£c ch·ªçn.</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>

    <script>
      document.getElementById("year-filter").addEventListener("change", function() {
        const selectedYear = this.value;
        const selectedMonth = document.getElementById("month-filter").value;
        let url = "/history_salary";
        const params = new URLSearchParams();
        if (selectedYear) params.append("year", selectedYear);
        if (selectedMonth) params.append("month", selectedMonth);
        window.location.href = url + (params.toString() ? "?" + params.toString() : "");
      });

      document.getElementById("month-filter").addEventListener("change", function() {
        const selectedYear = document.getElementById("year-filter").value;
        const selectedMonth = this.value;
        let url = "/history_salary";
        const params = new URLSearchParams();
        if (selectedYear) params.append("year", selectedYear);
        if (selectedMonth) params.append("month", selectedMonth);
        window.location.href = url + (params.toString() ? "?" + params.toString() : "");
      });

      const filterButton = document.getElementById("filter-button");
      if (filterButton) {
        filterButton.addEventListener("click", function() {
          window.location.href = "/history_salary";
        });
      }
    </script>
  </div>
{% endblock %}